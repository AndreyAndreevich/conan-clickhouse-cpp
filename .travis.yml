language: python
python: "3.6"
matrix:
  include:
    - os: linux
      dist: trusty
      sudo: required
      compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-7
      env:
        - MATRIX_EVAL="CC=gcc-7 && CXX=g++-7"
before_install:
  - eval "${MATRIX_EVAL}"
before_script:
  - pip install conan --upgrade
  - pip install conan_package_tools
script:
  - conan export . demo/testing
  - conan export . andrbek/testing
  - conan install clickhouse-cpp/0.2@demo/testing --build
  - conan test test_package clickhouse-cpp/0.2@demo/testing
deploy:
  - provider: script
    skip_cleanup: true
    script:
      conan remote add andrbek "https://api.bintray.com/conan/andrbek/conan" --insert &&
      conan user -p $BINTRAY_API_KEY -r andrbek andreyandreevich &&
      conan upload clickhouse-cpp/0.2@andrbek/testing --all -r=andrbek